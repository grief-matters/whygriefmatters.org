---
import CategoryPageHeader from "@ui/composites/CategoryPageHeader.astro";
import CategorySummaryPanel from "@ui/composites/CategorySummaryPanel.astro";
import SitePageLayout from "@ui/layouts/SitePageLayout.astro";
import Container from "@ui/primitives/Container.astro";
import ContentSurface from "@ui/primitives/ContentSurface.astro";
import LayoutSurface from "@ui/primitives/LayoutSurface.astro";
import Stack from "@ui/primitives/Stack.astro";
import ContentBlockRenderer from "./ContentBlockRenderer.astro";
import { getCollection } from "astro:content";

interface Props {
  categoryId: string;
  leadInContentBlockRefs?: Array<string>;
}

const { leadInContentBlockRefs, categoryId } = Astro.props;

const categories = await getCollection("categories");

const root = categories.find((x) => x.id === categoryId);
if (!root) {
  throw new Error(
    `Could not find [categoryEntry] in [categories] - [RootCategoryPage] for id: [${categoryId}]`,
  );
}
---

<SitePageLayout>
  <CategoryPageHeader categoryEntryData={root.data} />
  {
    leadInContentBlockRefs && (
      <LayoutSurface as="section" variant="neutral" paddingY={6}>
        <Container>
          <Stack>
            {leadInContentBlockRefs.map((blockId) => (
              <ContentBlockRenderer
                contentBlockRef={{
                  collection: "contentBlocks",
                  id: blockId,
                }}
              />
            ))}
          </Stack>
        </Container>
      </LayoutSurface>
    )
  }
  <LayoutSurface variantKey={3}>
    <Container paddingY={7}>
      <Stack spacing={4}>
        {
          root.data.subcategories.map((cat) => (
            <ContentSurface
              prominence="muted"
              variant="secondary"
              paddingX={5}
              paddingY={4}
            >
              <CategorySummaryPanel
                colorVariant="secondary"
                categoryId={cat.id}
              />
            </ContentSurface>
          ))
        }
      </Stack>
    </Container>
  </LayoutSurface>
</SitePageLayout>
