---
import type { ReferenceDataEntry } from "astro:content";
import { getEntry } from "astro:content";

import Container from "@ui/primitives/Container.astro";
import FeaturedWebsite from "@ui/composites/featured-resources/FeaturedWebsite.astro";
import Heading from "@ui/primitives/Heading.astro";
import PortableTextContentBlock from "@ui/primitives/PortableTextContentBlock.astro";
import SanityImage from "@ui/primitives/SanityImage.astro";

import DynamicPageLink from "./DynamicPageLink.astro";
import FeaturedResourceRenderer from "./FeaturedResourceRenderer.astro";
import PageLinksRenderer from "./PageLinksRenderer.astro";
import Slider from "@ui/layouts/slider/Slider.astro";
import Slide from "@ui/layouts/slider/Slide.astro";

interface Props {
  contentBlockRef: ReferenceDataEntry<"contentBlocks", string>;
  textAlign?: "center" | "left";
}

const { contentBlockRef, textAlign = "center" } = Astro.props;

const contentBlock = await getEntry(contentBlockRef);
---

{
  contentBlock.data.content.map((contentItem) => {
    switch (contentItem.contentType) {
      case "headingText":
        return <Heading as="h2" size={2} text={contentItem.text} />;
      case "richTextContentBlock":
        return (
          <Container padded>
            <PortableTextContentBlock
              textAlign={textAlign}
              portableText={contentItem.portableText}
              emphasized={contentItem.emphasized}
            />
          </Container>
        );
      case "richTextWithHeading":
        return (
          <Container padded>
            <Heading as="h3" size={1} text={contentItem.headingText} />
            <PortableTextContentBlock
              textAlign={textAlign}
              portableText={contentItem.portableText}
            />
          </Container>
        );
      case "accessibleImage":
        return (
          <Container>
            <SanityImage
              image={{ image: contentItem.image, altText: contentItem.altText }}
            />
          </Container>
        );
      case "imageRow":
        // TODO - this will need it's own component when we style
        return (
          <Container size={2}>
            {contentItem.images.map((img) => (
              <SanityImage image={img} />
            ))}
          </Container>
        );
      case "featuredResource":
        return (
          <Container padded>
            <FeaturedResourceRenderer
              resourceRef={contentItem.refId}
              resourceType={contentItem.refType}
            />
          </Container>
        );
      case "featuredResources":
        return (
          <Slider>
            {contentItem.resources.map((resource) => (
              <Slide>
                <FeaturedResourceRenderer
                  resourceRef={resource.refId}
                  resourceType={resource.refType}
                />
              </Slide>
            ))}
            {contentItem.resources.map((resource) => (
              <Slide>
                <FeaturedResourceRenderer
                  resourceRef={resource.refId}
                  resourceType={resource.refType}
                />
              </Slide>
            ))}
            {contentItem.resources.map((resource) => (
              <Slide>
                <FeaturedResourceRenderer
                  resourceRef={resource.refId}
                  resourceType={resource.refType}
                />
              </Slide>
            ))}
            {contentItem.resources.map((resource) => (
              <Slide>
                <FeaturedResourceRenderer
                  resourceRef={resource.refId}
                  resourceType={resource.refType}
                />
              </Slide>
            ))}
          </Slider>
        );
      case "featuredWebsite":
        return (
          <Container padded>
            <FeaturedWebsite websiteRef={contentItem.refId} />
          </Container>
        );
      case "featuredWebsites":
        return (
          <Container padded size={2}>
            {contentItem.websites.map((w) => (
              <FeaturedWebsite websiteRef={w} />
            ))}
          </Container>
        );
      case "featuredCrisisResource":
        return <div>[Still to implement `{contentItem.contentType}`]</div>;
      case "resourceLinks":
        return <div>[Still to implement `{contentItem.contentType}`]</div>;
      case "relativeLink":
        return <div>[Still to implement `{contentItem.contentType}`]</div>;
      case "resourcePageLink":
        return (
          <Container padded>
            <DynamicPageLink
              linkType={contentItem.contentType}
              label={contentItem.label}
              categoryRef={contentItem.category}
              populationRef={contentItem.population ?? undefined}
              resourceTypes={contentItem.resourceTypes ?? undefined}
            />
          </Container>
        );
      case "categoryPageLink":
        return (
          <Container padded>
            <DynamicPageLink
              linkType={contentItem.contentType}
              label={contentItem.label}
              categoryRef={contentItem.category}
            />
          </Container>
        );
      case "pageLinks":
        return (
          <Container padded>
            <PageLinksRenderer
              emphasized={contentItem.emphasized}
              links={contentItem.links}
            />
          </Container>
        );
      default:
        const _exhaustiveCheck: never = contentItem;
        throw new Error(
          `[ContentBlockRenderer] Unknown content type in data entry: \n${contentItem}`
        );
    }
  })
}
