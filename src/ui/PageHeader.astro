---
import { getFallbackImageCollection, getImageUrlBuilder } from "@common/client";
import { wgmDesignSystem as ds } from "@common/design-system";
import type { PageTitle } from "@common/page";
import type { SanityImage } from "@model/image";

interface Props {
  pageTitle: PageTitle;
  image?: SanityImage;
}

const fallbackImages = await getFallbackImageCollection();

const props = Astro.props;

const image =
  props.image ??
  fallbackImages[Math.floor(Math.random() * fallbackImages.length)];

const smImgUrl = image
  ? getImageUrlBuilder(image.image).width(640).height(320).url()
  : null;
const mdImgUrl = image
  ? getImageUrlBuilder(image.image).width(1024).height(512).url()
  : null;
const lgImgUrl = image
  ? getImageUrlBuilder(image.image).width(1280).height(640).url()
  : null;
const xlImgUrl = image
  ? getImageUrlBuilder(image.image).width(1560).height(650).url()
  : null;
---

<header class={ds.background.color.neutral.defaultLighter}>
  <div class:list={["p-3 relative", "xl:container xl:p-6"]}>
    <div class:list={["lg:text-right"]}>
      <img
        srcset={`${smImgUrl} 640w, ${mdImgUrl} 1024w, ${lgImgUrl} 1280w, ${xlImgUrl} 1560w`}
        sizes="(max-width: 640px) 640px, (max-width: 1024px) 1024px, (max-width: 1280px) 1280px, 1560px"
        class:list={["inline-block border-8 border-white drop-shadow-md lg:w-2/3"]}
      />
    </div>
    <h1
      class:list={[
        "overflow-hidden",
        "-mt-9",
        "bottom-0 left-0",
        "xl:max-w-2xl ",
        "absolute lg:ml-80 lg:mb-12 mx-10 sm:mx-24"
      ]}
    >
      {
        props.pageTitle.supTitle && (
          <span class="block">
            <span
              class:list={[
                "font-serif italic",
                "box-decoration-clone px-3",
                ds.background.color?.primary.default,
                ds.typography.color?.primary.contrast,
              ]}
            >
              {props.pageTitle.supTitle}
            </span>
          </span>
        )
      }

      <span class="block">
        <span
          class:list={[
            "text-3xl font-serif font-medium lg:text-4xl",
            "box-decoration-clone px-3",
            ds.background.color?.primary.default,
            ds.typography.color?.primary.contrast,
          ]}
        >
          {props.pageTitle.title}
        </span>
      </span>

      {
        props.pageTitle.subTitle && (
          <span class="block">
            <span>{props.pageTitle.subTitle}</span>
          </span>
        )
      }
    </h1>
  </div>
</header>