---
import type { Polymorphic } from "astro/types";
import { type OnSurfaceColorVariant } from "@styles/utils/color";
import { textPresetClassMap, type TextPreset } from "@styles/utils/typography";

type TextButtonTag = "button" | "a";

type Props<T extends TextButtonTag = "button"> = Polymorphic<{ as: T }> & {
  colorVariant?: OnSurfaceColorVariant;
  variant?: TextPreset;
  hoverToMuted?: boolean;
  label?: string;
};

const {
  as: Tag = "button",
  colorVariant = "primary",
  variant = "button-1",
  hoverToMuted = true,
  label,
  ...attrs
} = Astro.props;

const baseClasses = ["cursor-pointer", "transition-colors duration-300"];

const textColorHoverMap: Record<
  OnSurfaceColorVariant,
  { defaultToMuted: string[]; mutedToDefault: string[] }
> = {
  primary: {
    defaultToMuted: [
      "text-onSurface-primary--default",
      "hover:text-onSurface-primary--muted",
    ],
    mutedToDefault: [
      "text-onSurface-primary--muted",
      "hover:text-onSurface-primary--default",
    ],
  },
  secondary: {
    defaultToMuted: [
      "text-onSurface-secondary--default",
      "hover:text-onSurface-secondary--muted",
    ],
    mutedToDefault: [
      "text-onSurface-secondary--muted",
      "hover:text-onSurface-secondary--default",
    ],
  },
  tertiary: {
    defaultToMuted: [
      "text-onSurface-tertiary--default",
      "hover:text-onSurface-tertiary--muted",
    ],
    mutedToDefault: [
      "text-onSurface-tertiary--muted",
      "hover:text-onSurface-tertiary--default",
    ],
  },
  coolNeutral: {
    defaultToMuted: [
      "text-onSurface-coolNeutral--default",
      "hover:text-onSurface-coolNeutral--muted",
    ],
    mutedToDefault: [
      "text-onSurface-coolNeutral--muted",
      "hover:text-onSurface-coolNeutral--default",
    ],
  },
  warmNeutral: {
    defaultToMuted: [
      "text-onSurface-warmNeutral--default",
      "hover:text-onSurface-warmNeutral--muted",
    ],
    mutedToDefault: [
      "text-onSurface-warmNeutral--muted",
      "hover:text-onSurface-warmNeutral--default",
    ],
  },
  primaryContrast: {
    defaultToMuted: [
      "text-onSurface-primaryContrast--default",
      "hover:text-onSurface-primaryContrast--muted",
    ],
    mutedToDefault: [
      "text-onSurface-primaryContrast--muted",
      "hover:text-onSurface-primaryContrast--default",
    ],
  },
};

const colorClasses = hoverToMuted
  ? textColorHoverMap[colorVariant].defaultToMuted
  : textColorHoverMap[colorVariant].mutedToDefault;

const hasDefaultSlot = Astro.slots.has("default");
---

<Tag
  class:list={[...baseClasses, textPresetClassMap[variant], ...colorClasses]}
  {...attrs}
>
  {hasDefaultSlot ? <slot /> : label}
</Tag>
