---
import { getCollection, type CollectionEntry } from "astro:content";

import kebabCase from "lodash/kebabCase";

import Section from "@ui/layouts/Section.astro";
import SitePageLayout from "@ui/layouts/SitePageLayout.astro";

import Container from "@ui/base/Container.astro";
import LayoutSurface from "@ui/base/LayoutSurface.astro";
import Link from "@ui/base/Link.astro";
import PersonAvatar from "@ui/base/PersonAvatar.astro";
import PortableTextContentBlock from "@ui/base/PortableTextContentBlock.astro";
import Stack from "@ui/base/Stack.astro";
import Typography from "@ui/base/Typography.astro";

interface Props {
  personData: CollectionEntry<"people">["data"];
}

export async function getStaticPaths() {
  const people = await getCollection(
    "people",
    (x) => x.data.personalStory !== null,
  );

  return people.map((person) => ({
    params: { person: kebabCase(person.data.fullName) },
    props: {
      personData: person.data,
    },
  }));
}

const { personData } = Astro.props;
---

<SitePageLayout>
  <LayoutSurface as="header" colorVariant={"primaryContrast"}>
    <Container paddingX={4} paddingY={4} size={2}>
      <div class="space-y-3 md:gap-6 md:flex md:items-center md:justify-evenly">
        <Stack spacing={1}>
          <Typography as="h1" variant="title-1" colorVariant="primaryContrast">
            {personData.fullName}
          </Typography>
          <Typography variant="title-4" colorVariant="primaryContrast">
            {personData.role}
          </Typography>
          <Typography colorVariant="primaryContrast">
            {`Learn more about our ${personData.role}, ${personData.fullName}`}
          </Typography>
        </Stack>
        <div class="flex justify-center">
          <PersonAvatar
            image={personData.avatar !== null
              ? { image: personData.avatar, altText: "" }
              : null}
          />
        </div>
      </div>
    </Container>
  </LayoutSurface>
  <Section>
    {
      personData.shortBio && (
        <PortableTextContentBlock
          textAlign="center"
          portableText={personData.shortBio}
        />
      )
    }
  </Section>
  <Section colorVariantKey={3}>
    <Typography
      as="h2"
      variant="title-2"
      set:text="My Story"
      marginBottom={3}
    />
    {
      personData.personalStory && (
        <PortableTextContentBlock portableText={personData.personalStory} />
      )
    }
    <div class="text-center my-6">
      <Link to={`/about/team`}>
        {"Meet the rest of our team, volunteers and other contributors"}
      </Link>
    </div>
  </Section>
</SitePageLayout>
