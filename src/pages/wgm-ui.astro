---
import startCase from "lodash/startCase";
import { getImageUrlBuilder } from "@sanity-integration/sanity-image-builder";

import { getOrganization } from "@content/loaders/organizationLoader";

import "@styles/main.css";
import {
  type LayoutSurfaceVariantKey,
  colorVariants,
} from "@styles/utils/color";
import type { Prominence } from "@styles/utils/shared";
import { spaceSettingKeys } from "@styles/utils/spacing";
import { textPresets } from "@styles/utils/typography";

import Shell from "@ui/layouts/Shell.astro";
import Button from "@ui/base/Button.astro";
import Container from "@ui/base/Container.astro";
import ContentSurface from "@ui/base/ContentSurface.astro";
import LayoutSurface from "@ui/base/LayoutSurface.astro";
import Link from "@ui/base/Link.astro";
import Stack from "@ui/base/Stack.astro";
import Typography from "@ui/base/Typography.astro";

const org = await getOrganization();
if (!org) {
  throw new Error('Failed to [getOrganization] for "src/pages/index.astro"');
}

const logoUrl = org.logos.onLight
  ? getImageUrlBuilder(org.logos.onLight).url()
  : null;

const codeClasses =
  "outline outline-line-primary--prominent text-sm bg-contentSurface-neutral--muted rounded-sm px-2 mx-1 text-onSurface-coolNeutral--default text-nowrap";
---

<Shell>
  <header
    class:list={[
      "border-t-6 md:border-t-12 border-t-line-brand--accent",
      "border-b-6 border-b-onSurface-primary--default",
    ]}
  >
    <div
      class:list={[
        "flex flex-col-reverse sm:flex-row sm:justify-between gap-x-6",
        "p-3 sm:p-6",
        "max-w-6xl mx-auto",
      ]}
    >
      <div
        class:list={[
          "space-y-2 flex flex-wrap sm:flex-nowrap items-center gap-x-6 grow",
        ]}
      >
        <a class="block basis-50" href="/">
          <img class:list={["h-16"]} src={logoUrl} alt={`${org.name} logo`} />
        </a>
      </div>
      <div class:list={["flex justify-end items-center gap-3"]}>
        <Link to={"/about"} label="About" variant="button-2" />
        <Link to={"/contact"} label="Contact" variant="button-2" />
        <Button
          label="Donate"
          textVariant="button-1"
          styleVariant="outlined"
          colorVariant="donate"
        />
      </div>
    </div>
  </header>
  <main data-pagefind-ignore="all">
    <LayoutSurface variant="neutral" variantKey={1} paddingY={6}>
      <Container paddingX={1} paddingY={1}>
        <Stack>
          <Typography as="h1" variant="title-1">Why Grief Matters UI</Typography
          >
          <Typography variant="body-1">
            {"Welcome to the Why Grief Matters UI."}
          </Typography>
          <Typography
            variant="body-1"
            set:text="Building templates and components for the Why Grief Matters website is kept intentionally constrained in order to maintain simplicity and design coherence."
          />
        </Stack>
      </Container>
    </LayoutSurface>
    <LayoutSurface variant="neutral" variantKey={3} paddingY={6}>
      <Container paddingX={1} paddingY={1}>
        <Stack>
          <Typography as="h2" variant="title-2">Typography</Typography>
          <Typography
            set:text="The number of style variants available is kept intentionally limited
            but offers more than enough to create compelling pages with good
            visual hierarchy"
          />
          {
            textPresets.map((preset) => (
              <div>
                <Typography variant={preset}>{startCase(preset)}</Typography>
                <Typography variant="subtitle-1">{preset}</Typography>
              </div>
            ))
          }
        </Stack>
      </Container>
    </LayoutSurface>
    <LayoutSurface paddingY={6}>
      <Container paddingX={1} paddingY={1}>
        <Stack>
          <Typography as="h2" variant="title-2">Layout Surface</Typography>
          <Typography
            variant="body-1"
            set:html={`The <code class="${codeClasses}">LayoutSurface</code> component should be used to define sections on a page. It can be used with a number of color variants.`}
          />
        </Stack>
      </Container>
    </LayoutSurface>
    {
      colorVariants.map((variant) =>
        variant === "neutral" ? (
          ([1, 2, 3, 4] as LayoutSurfaceVariantKey[]).map((n) => (
            <LayoutSurface as="div" variant={variant} variantKey={n}>
              <Container paddingX={1} paddingY={1}>
                <Typography colorVariant="coolNeutral">{`${variant} - ${n}`}</Typography>
              </Container>
            </LayoutSurface>
          ))
        ) : (
          <LayoutSurface as="div" variant={variant}>
            <Container paddingX={1} paddingY={1}>
              <Typography colorVariant={variant}>{variant}</Typography>
            </Container>
          </LayoutSurface>
        ),
      )
    }
    <LayoutSurface variantKey={2} paddingY={6}>
      <Container paddingX={1} paddingY={1}>
        <Stack spacing={2}>
          <Typography as="h2" variant="title-2">Content Surface</Typography>
          <Typography
            variant="body-1"
            set:html={`The <code class="${codeClasses}">ContentSurface</code> component should be used to create areas where content is grouped together in some logical way.`}
          />
          <ContentSurface variant="featureCard">
            <p class="p-3">{`Feature Card content surface`}</p>
          </ContentSurface>
          {
            colorVariants.map((variant) =>
              (["muted", "default", "prominent"] as Prominence[]).map((p) => (
                <ContentSurface
                  paddingX={1}
                  paddingY={1}
                  variant={variant}
                  prominence={p}
                >
                  <Typography
                    colorVariant={
                      variant === "neutral" ? "warmNeutral" : variant
                    }
                    set:html={`The <code class="${codeClasses}">${variant}-${p}</code> content surface using matched typography color.`}
                  />
                </ContentSurface>
              )),
            )
          }
          <Typography
            set:text="We can combine different content surfaces together to create layered effects, giving us a lot of flexibility when building new designs."
          />
          <ContentSurface
            prominence="muted"
            paddingX={1}
            paddingY={1}
            variant="neutral"
          >
            <Stack>
              <Typography
                set:text={"Imagine that this is some kind of panel component"}
              />
              <ContentSurface paddingX={1} paddingY={1}>
                <Typography
                  set:text=`We can create different effects using the "prominence" concept`
                />
              </ContentSurface>
            </Stack>
          </ContentSurface>
        </Stack>
      </Container>
    </LayoutSurface>
    <LayoutSurface variantKey={3} paddingY={6}>
      <Container paddingX={1} paddingY={1}>
        <Stack spacing={2}>
          <Typography as="h2" variant="title-2">Buttons</Typography>
          <Typography as="p">
            {"Buttons can be rendered as link or button tags"}
          </Typography>
          <Stack spacing={1} direction="horizontal">
            {
              colorVariants.map((c) => (
                <Button
                  as="a"
                  colorVariant={c}
                  label={`${startCase(c)} Button`}
                />
              ))
            }
          </Stack>
          <Typography>
            {
              "Button labels cab set using the `label` prop or by passing content to its `slot`. Be aware you will be responsible for styling if using the slot"
            }
          </Typography>
          <Button>
            <Typography>
              {"Button using a "}
              <strong class="text-bold">{"Typography"}</strong>
              {" component as its label"}
            </Typography>
          </Button>
        </Stack>
      </Container>
    </LayoutSurface>
    <LayoutSurface paddingY={6}>
      <Container paddingX={1} paddingY={1}>
        <Stack spacing={2}>
          <Typography as="h2" variant="title-2">Spacing</Typography>
          <Typography as="p">
            {"Spacing"}
          </Typography>
          <div class="flex flex-col space-y-3">
            {
              spaceSettingKeys.map((k) => (
                <div class="self-start">
                  <ContentSurface paddingX={k} paddingY={k} variant={"primary"}>
                    <Typography
                      set:text={`Space Setting ${k} - equivalent to ${k * 4} in Figma`}
                    />
                  </ContentSurface>
                </div>
              ))
            }
          </div>
        </Stack>
      </Container>
    </LayoutSurface>
  </main>
</Shell>
